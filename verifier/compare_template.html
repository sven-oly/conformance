<html>
  <!--
      Build a comparison page for test results on the same test suite,
      including graphics and other tools to better understand differences
      in results between platforms and different test data versions.
      E.g., NodeJS v 21.6.0 number format with ICU 74 vs.
      ICU4C 74.2 with ICU74 test data.

      Started 19-Jan-2024, cwc.

      https://www.freecodecamp.org/news/interactive-heatmap-in-javascript/
    -->
  <head>
    <title>Heatmap in JavaScript</title>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-heatmap.min.js"></script>
    <script>

    // Pointers to the data directories
    const data_dirs = $data_dirs;
    const test_name = $test_names;
    let compare_directories = ['', ''];  // Two data directories for comparison

    function loadRawData(data_dir) {
        // Get the pass, fail, etc. JSON data from this directory.
        // Via fetch
        // TODO: Open the files and the JSON data for each status.

                 // Return these data pointers
    let p1 = fetch('./pass.json');
    let p2 = fetch('./failing_tests.json');
    let p3 = fetch('./test_errors.json');
    let p4 = fetch('./unsupported.json');

    // Synchronize all the data loading and charts / pagination
    Promise.all([
    p1.then((response) => response.json())
      .then((data) => {
      test_results['pass'].json = data}),
      p2.then((response) => response.json())
      .then((data) => {
      test_results['fail'].json = data}),
      p3.then((response) => response.json())
      .then((data) => {
      test_results['error'].json = data}),
      p4.then((response) => response.json())
      .then((data) => {
      test_results['unsupported'].json = data}),

      // Synchronize all the data loading and charts / pagination
      Promise.all([
          p1.then((response) => response.json())
              .then((data) => {
                  test_results['pass'].json = data}),
          p2.then((response) => response.json())
              .then((data) => {
                  test_results['fail'].json = data}),
          p3.then((response) => response.json())
              .then((data) => {
                  test_results['error'].json = data}),
          p4.then((response) => response.json())
          .then((data) => {
                  test_results['unsupported'].json = data}),

      ]).then(([ p1, p2, p3, p4, _ready]) => {
      // TODO: When done with both sets, compete the intersections of
      // each class.
      }

    }

    // Set up a heat map
    anychart.onDocumentReady(function () {
        // create a heatmap
        var chart = anychart.heatMap(getData());
        // set a custom color scale
        var colorScale = anychart.scales.ordinalColor();
        colorScale.ranges([
          { less: 500, color: "#B0D8A4" },
          { from: 500, to: 900, color: "#FEE191" },
          { from: 900, to: 1300, color: "#FD8060" },
          { greater: 1300, color: "#CC333F" }
        ]);
        chart.colorScale(colorScale);
        // style the coloring in the hovered state
        chart
          .hovered()
          .fill(function () {
            return anychart.color.darken(this.sourceColor, 0.25);
          });
        // hide the labels
        chart.labels(false);
        // customize the axes
        chart.xAxis().stroke(null);
        chart.yAxis().stroke(null);
        chart.yAxis().labels().padding([0, 10, 0, 0]);
        chart.xAxis().labels().padding([0, 0, 10, 0]);
        // set the tooltip
        chart.tooltip().title().useHtml(true);
        chart
          .tooltip()
          .useHtml(true)
          .titleFormat(function () {
            return "Accidents - " + this.heat;
          })
          .format(function () {
            return (
              '<span style="color: #CECECE">Day: </span>' +
              this.x +
              "<br/>" +
              '<span style="color: #CECECE">Time: </span>' +
              this.y
            );
          });
        // name the heatmap
        chart
          .title()
          .enabled(true)
          .text('$title')
          .padding([0, 0, 20, 0]);
        // set the container for the heatmap
        chart.container("heat_map_container");
        // draw the heatmap
        chart.draw();
      });

    // All the code for the JS heatmap will come here
      // add the data
      function getData() {
         // TODO: Fill this in
         return [];
    }


    </script>
    <style type="text/css">
      html, body, #head_map_container_ container {
          width: 80%; height: 80%; margin: 0; padding: 0;
      }
      </style>
      <style>
        .main div {
          float: left;
          clear: none;
        }
      </style>
</head>

    <body>
    <h2>Compare test results for $test_type</h2>
    <div if="instance_selection">
      <p>Instances for test $test_type. Pick 2!</p>
      <div id="instance_selectors"></div>
      </div>
    <div id="heat_map_container"></div>

  </body>
</html>
